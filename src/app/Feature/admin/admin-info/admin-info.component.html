<div class="container-fluid py-4 page-container">
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex align-items-center justify-content-between">
        <h2 class="page-title h2 fw-bold mb-0">
          <i class="bi bi-building-gear me-2 text-primary-gradient"></i>
          إدارة معلومات الشركة
        </h2>
      </div>
    </div>
  </div>

  <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
    <div class="card-header bg-white border-0 pt-4 px-4 px-md-5">
      <div class="section-title h5 fw-bold text-primary">
        المعلومات الأساسية
      </div>
    </div>

    <div class="card-body p-4 p-md-5 pt-2">
      <form [formGroup]="infoForm" (ngSubmit)="onSubmit()">
        <!-- Basic Info -->
        <div class="row g-4 p-3 mb-5">
          <div class="col-12">
            <div class="form-floating">
              <input
                type="text"
                class="form-control rounded-3"
                id="companyName"
                placeholder="اسم الشركة"
                formControlName="name"
                [class.is-invalid]="
                  infoForm.get('name')?.invalid && infoForm.get('name')?.touched
                "
              />
              <label for="companyName">اسم الشركة</label>
              <div class="invalid-feedback fw-bold">
                <i class="bi bi-exclamation-circle me-1"></i> هذا الحقل مطلوب
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-floating">
              <textarea
                class="form-control rounded-3 h-100"
                id="whoWeAre"
                placeholder="من نحن"
                formControlName="whoWeAre"
                style="min-height: 120px"
                [class.is-invalid]="
                  infoForm.get('whoWeAre')?.invalid &&
                  infoForm.get('whoWeAre')?.touched
                "
              ></textarea>
              <label for="whoWeAre">من نحن (وصف مختصر)</label>
              <div class="invalid-feedback fw-bold">
                <i class="bi bi-exclamation-circle me-1"></i> هذا الحقل مطلوب
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-floating">
              <textarea
                class="form-control rounded-3 h-100"
                id="purpose"
                placeholder="الغرض"
                formControlName="purpose"
                style="min-height: 120px"
                [class.is-invalid]="
                  infoForm.get('purpose')?.invalid &&
                  infoForm.get('purpose')?.touched
                "
              ></textarea>
              <label for="purpose">الغرض (Purpose)</label>
              <div class="invalid-feedback fw-bold">
                <i class="bi bi-exclamation-circle me-1"></i> هذا الحقل مطلوب
              </div>
            </div>
          </div>

          <div class="col-12">
            <div
              class="upload-zone p-4 border-2 border-dashed rounded-4 bg-light text-center position-relative hover-lift transition-all"
            >
              <input
                type="file"
                (change)="onLogoSelect($event)"
                accept="image/*"
                class="position-absolute top-0 start-0 w-100 h-100 opacity-0 cursor-pointer"
                id="logoUpload"
              />
              <div
                class="d-flex flex-column flex-md-row align-items-center justify-content-center gap-4"
              >
                <div
                  class="upload-icon-wrapper rounded-circle bg-primary-subtle text-primary p-3 mb-3 mb-md-0"
                  *ngIf="!selectedLogoPreview"
                >
                  <i class="bi bi-cloud-arrow-up fs-1"></i>
                </div>

                <div class="text-start" *ngIf="!selectedLogoPreview">
                  <h5 class="fw-bold mb-1">رفع شعار الشركة</h5>
                  <p class="text-muted small mb-0">
                    انقر أو اسحب الصورة هنا (PNG, JPG)
                  </p>
                </div>

                <div
                  class="logo-preview-wrapper position-relative"
                  *ngIf="selectedLogoPreview"
                >
                  <img
                    [src]="selectedLogoPreview"
                    class="img-fluid rounded-3 shadow-sm"
                    alt="Logo Preview"
                    style="max-height: 100px"
                  />
                  <span
                    class="badge bg-success position-absolute top-0 start-100 translate-middle rounded-pill"
                  >
                    <i class="bi bi-check-lg"></i>
                  </span>
                  <p class="small text-muted mt-2 mb-0">انقر للتغيير</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Addresses -->
        <div class="mb-5 section-wrapper rounded-4 p-4 bg-white border">
          <div
            class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3"
          >
            <h4 class="h5 fw-bold text-dark m-0">
              <i class="bi bi-geo-alt me-2 text-warning"></i> العناوين
            </h4>
            <button
              type="button"
              (click)="addAddress()"
              class="btn btn-warning-subtle btn-sm rounded-pill fw-bold px-3 btn-success"
            >
              <i class="bi bi-plus-lg me-1"></i> إضافة جديد
            </button>
          </div>

          <div formArrayName="addresses">
            <div
              *ngFor="let address of addresses.controls; let i = index"
              [formGroupName]="i"
              class="address-card card mb-3 border bg-light-subtle rounded-3 position-relative overflow-hidden"
            >
              <div class="card-body p-4">
                <button
                  type="button"
                  (click)="removeAddress(i)"
                  class="btn btn-icon btn-danger-soft position-absolute top-0 end-0 m-2 rounded-circle shadow-sm"
                  title="حذف العنوان"
                >
                  <i class="bi bi-trash"></i>
                </button>

                <div class="row g-3 p-3">
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control border-0 bg-white"
                        [id]="'line1' + i"
                        formControlName="line1"
                        placeholder="الشارع"
                      />
                      <label [for]="'line1' + i">الشارع (Line 1)</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control border-0 bg-white"
                        [id]="'line2' + i"
                        formControlName="line2"
                        placeholder="الشارع 2"
                      />
                      <label [for]="'line2' + i">الشارع 2 (اختياري)</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control border-0 bg-white"
                        [id]="'city' + i"
                        formControlName="city"
                        placeholder="المدينة"
                      />
                      <label [for]="'city' + i">المدينة</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control border-0 bg-white"
                        [id]="'state' + i"
                        formControlName="state"
                        placeholder="المحافظة"
                      />
                      <label [for]="'state' + i">الولاية/المحافظة</label>
                    </div>
                  </div>
                  <div class="col-md-4 d-flex align-items-center">
                    <div class="form-check form-switch custom-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        role="switch"
                        [id]="'isPrimaryAddr' + i"
                        formControlName="isPrimary"
                      />
                      <label
                        class="form-check-label fw-bold ms-2"
                        [for]="'isPrimaryAddr' + i"
                        >عنوان رئيسي</label
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            *ngIf="addresses.controls.length === 0"
            class="text-center py-4 text-muted bg-light rounded-3 border border-dashed"
          >
            <i class="bi bi-geo mb-2 fs-3 d-block"></i>
            لا توجد عناوين مضافة حالياً
          </div>
        </div>

        <!-- Phones -->
        <div class="mb-5 section-wrapper rounded-4 p-4 bg-white border">
          <div
            class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3"
          >
            <h4 class="h5 fw-bold text-dark m-0">
              <i class="bi bi-telephone me-2 text-success"></i> أرقام الهواتف
            </h4>
            <button
              type="button"
              (click)="addPhone()"
              class="btn btn-success-subtle btn-sm rounded-pill fw-bold px-3 btn-success"
            >
              <i class="bi bi-plus-lg me-1"></i> إضافة هاتف
            </button>
          </div>

          <div formArrayName="phones" class="row g-3">
            <div
              *ngFor="let phone of phones.controls; let i = index"
              [formGroupName]="i"
              class="col-md-6 col-lg-4"
            >
              <div
                class="phone-card card border bg-light-subtle rounded-3 h-100 position-relative theme-card-hover"
              >
                <button
                  type="button"
                  (click)="removePhone(i)"
                  class="btn btn-link text-danger position-absolute top-0 end-0 p-2 text-decoration-none"
                  title="حذف"
                >
                  <i class="bi bi-x-circle-fill"></i>
                </button>

                <div class="card-body p-3 pt-4 p-2">
                  <div class="form-floating mb-3 p-2">
                    <input
                      type="text"
                      class="form-control border-0 bg-white"
                      [id]="'phone' + i"
                      formControlName="number"
                      placeholder="رقم الهاتف"
                    />
                    <label [for]="'phone' + i">رقم الهاتف</label>
                  </div>

                  <div class="form-check form-switch custom-switch">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      role="switch"
                      [id]="'isPrimaryPhone' + i"
                      formControlName="isPrimary"
                    />
                    <label
                      class="form-check-label small fw-bold ms-2"
                      [for]="'isPrimaryPhone' + i"
                      >رقم رئيسي</label
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            *ngIf="phones.controls.length === 0"
            class="text-center py-4 text-muted bg-light rounded-3 border border-dashed"
          >
            <i class="bi bi-telephone-x mb-2 fs-3 d-block"></i>
            لا توجد أرقام مضافة
          </div>
        </div>

        <div class="d-flex justify-content-end gap-3 mt-5 pt-3 border-top">
          <button
            type="submit"
            [disabled]="infoForm.invalid"
            class="btn btn-primary-gradient btn-lg px-5 rounded-pill shadow-lg fw-bold d-flex align-items-center gap-2"
          >
            <i class="bi bi-save"></i>
            حفظ التغييرات
          </button>
        </div>

        <div
          *ngIf="submitSuccess"
          class="alert alert-success mt-4 rounded-3 shadow-sm d-flex align-items-center"
          role="alert"
        >
          <i class="bi bi-check-circle-fill fs-4 me-3 text-success"></i>
          <div>
            <div class="fw-bold">تم بنجاح!</div>
            <div class="small">تم تحديث معلومات الشركة وحفظها في النظام.</div>
          </div>
        </div>

        <div
          *ngIf="submitError"
          class="alert alert-danger mt-4 rounded-3 shadow-sm d-flex align-items-center"
          role="alert"
        >
          <i class="bi bi-exclamation-triangle-fill fs-4 me-3 text-danger"></i>
          <div>
            <div class="fw-bold">خطأ في الحفظ</div>
            <div class="small">
              حدث خطأ غير متوقع، يرجى المحاولة مرة أخرى لاحقاً.
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
